---
- name: RedHat | Ensure postgreSQL rpm is installed
  yum:
    name: "https://yum.postgresql.org/{{postgresql_version}}/redhat/rhel-7-x86_64/pgdg-centos{{postgresql_version_major}}{{postgresql_version_minor}}-{{postgresql_version}}-{{postgresql_version_patch}}.noarch.rpm"
    state: present
  become: yes

- name: RedHat | Ensure postgreSQL is installed
  yum:
    name: "postgresql{{postgresql_version_major}}{{postgresql_version_minor}}-server"
    state: present
  become: yes
  register: installed

- name: RedHat | Make sure the postgres data directory exists
  command: "/usr/pgsql-{{ postgresql_version }}/bin/postgresql{{postgresql_version_major}}{{postgresql_version_minor}}-setup initdb"
  when: installed|changed
